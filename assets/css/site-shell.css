/* Shared site shell enhancements: mega dropdown + active link styling */

/* Prevent accidental horizontal scrolling site-wide */
html, body{max-width:100%}
body{overflow-x:hidden}

/* Active state (header + footer) */
nav a[aria-current="page"],
nav a.is-active{
  color:var(--brand-dark);
  font-weight:800;
}
nav a[aria-current="page"]::after,
nav a.is-active::after{
  opacity:1;
}

.site-footer a[aria-current="page"],
.site-footer a.is-active{
  color:#fff;
  text-decoration:underline;
  text-underline-offset:4px;
}

/* Footer logo: make it read better on dark backgrounds */
.site-footer .footer-brand img{
  border-radius:12px !important;
  padding:8px 10px !important;
  background:rgba(255,255,255,.92) !important;
  box-shadow:0 12px 26px rgba(2,8,23,.22) !important;
}

/* Mega dropdown */
/* Default: injected mobile-only content should never affect desktop layout */
.mobile-nav-extras{display:none}

/* Make the mega panel position relative to the whole header nav so it stays inside the viewport,
  even when the <ul> shrinks to the width of its items. */
header nav[aria-label="Primary"]{position:relative}
header nav[aria-label="Primary"] ul{position:static}
/* Make the mega panel position relative to the whole nav (not the single li)
  so it stays inside the viewport. */
nav li.has-submenu{position:static}

nav li.has-submenu > a{
  display:inline-flex;
  align-items:center;
  gap:6px;
}
nav li.has-submenu > a::after{
  content:'â–¾';
  font-size:12px;
  opacity:.75;
  transform:translateY(-1px);
}

.nav-mega{
  position:absolute;
  left:0;
  right:0;
  top:calc(100% + 14px);
  transform:translateY(8px);
  width:auto;
  max-width:1100px;
  margin:0 auto;
  background:#fff;
  border:1px solid rgba(148,163,184,.45);
  box-shadow:0 22px 55px rgba(2,8,23,.14);
  opacity:0;
  pointer-events:none;
  transition:.18s ease;
  z-index:90;
}

/* Header: keep content visible without horizontal scroll */
header{max-width:100%}
header .logo{min-width:0;flex:0 1 auto}
header .logo picture, header .logo img{display:block;max-width:100%}
/* Slightly reduce logo so desktop nav fits in one row */
header .logo img{max-width:min(220px, 38vw)}
@media(min-width:981px){
  header .logo img{height:44px !important;width:auto !important}
}
header nav[aria-label="Primary"]{min-width:0;flex:1 1 auto}
/* Desktop: keep the primary nav in one line */
header nav[aria-label="Primary"] ul{flex-wrap:nowrap !important;min-width:0;gap:20px}
header nav[aria-label="Primary"] ul > li{flex:0 0 auto}
header nav[aria-label="Primary"] > ul,
header nav[aria-label="Primary"] a{white-space:nowrap}
header .header-actions{flex:0 0 auto}
header .header-actions .btn{white-space:nowrap}

/* Hide hamburger on desktop (some pages define it inline, so use !important) */
@media(min-width:981px){
  header .menu-toggle{display:none !important}
}

/* Mid-width desktops: allow header to wrap instead of overflowing */
@media(min-width:981px) and (max-width:1240px){
  header{gap:14px}
  header nav[aria-label="Primary"] ul{gap:14px}
  header nav[aria-label="Primary"] a{font-size:13px;white-space:nowrap}
  header .header-actions strong{font-size:14px}
  header .header-actions .btn{font-size:13px;padding:10px 14px}
}

/* Mobile: hide topbar + move actions into drawer (injected by JS) */
@media(max-width:980px){
  .topbar{display:none !important}
  header .header-actions .contact,
  header .header-actions .btn{display:none !important}
  header .menu-toggle{display:grid !important}

  /* Drawer extras */
  .mobile-nav-extras{display:block}
  .mobile-nav-extras{margin-top:18px;padding-top:18px;border-top:1px solid #e5e7eb}
  .mobile-nav-extras .mobile-cta{display:flex;gap:10px;flex-direction:column}
  .mobile-nav-extras .btn{display:inline-flex;justify-content:center;align-items:center;text-decoration:none;border-radius:10px}
  .mobile-nav-extras .mobile-meta{margin-top:14px;display:flex;flex-direction:column;gap:10px;color:rgba(2,8,23,.72);font-size:13px;line-height:1.35}
  .mobile-nav-extras .mobile-meta a{color:inherit;text-decoration:none}
  .mobile-nav-extras .mobile-meta a:hover{text-decoration:underline}
  .mobile-nav-extras .mobile-social{display:flex;gap:10px;margin-top:6px}
  .mobile-nav-extras .mobile-social a{width:38px;height:38px;border-radius:999px;display:grid;place-items:center;background:rgba(2,8,23,.06)}
  .mobile-nav-extras .mobile-social a:hover{background:rgba(2,8,23,.10)}
  .mobile-nav-extras .mobile-social svg{width:16px;height:16px;display:block}
}

.nav-mega::before{
  content:"";
  position:absolute;
  top:-10px;
  left:50%;
  transform:translateX(-50%) rotate(45deg);
  width:18px;
  height:18px;
  background:#fff;
  border-left:1px solid rgba(148,163,184,.45);
  border-top:1px solid rgba(148,163,184,.45);
}

.nav-mega-inner{padding:22px 22px}
.nav-mega-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit, minmax(240px, 1fr));
  gap:26px;
}

/* Dropdown links should wrap naturally for long names */
.nav-col a{white-space:normal;line-height:1.25;overflow-wrap:break-word}
.nav-col a .arr{display:none}

/* Prevent mega menu from being clipped on short viewports */
.nav-mega-inner{max-height:calc(100vh - 160px);overflow:auto}

.nav-col-title{
  font-size:12px;
  font-weight:900;
  letter-spacing:.14em;
  text-transform:uppercase;
  color:var(--brand-dark);
  margin-bottom:12px;
}

.nav-col{padding:0 18px}
.nav-col + .nav-col{border-left:1px solid rgba(148,163,184,.35)}

.nav-col a{
  display:block;
  padding:10px 10px;
  border-radius:10px;
  text-decoration:none;
  color:var(--ink);
  font-weight:600;
  font-size:14px;
  transition:.15s ease;
}

.nav-col a:hover{background:rgba(117,191,83,.12)}
.nav-col a:focus-visible{outline:3px solid rgba(119,195,79,.55);outline-offset:3px}

.nav-col a .arr{opacity:.65;flex:0 0 auto}

nav li.has-submenu:hover .nav-mega,
nav li.has-submenu:focus-within .nav-mega{
  opacity:1;
  pointer-events:auto;
  transform:translateY(0);
}

/* Mobile: make dropdown sections toggleable */
@media(max-width:980px){
  .nav-mega{
    position:static;
    left:auto;
    top:auto;
    width:auto;
    transform:none;
    opacity:1;
    pointer-events:auto;
    border:none;
    box-shadow:none;
    padding:0;
    margin:8px 0 14px;
    display:none;
  }
  .nav-mega::before{display:none}
  .nav-mega-inner{padding:0}
  .nav-mega-grid{grid-template-columns:1fr;gap:12px}
  .nav-col{border-right:none;padding-right:0;border-top:1px solid #e5e7eb;padding-top:10px}
  .nav-col:first-child{border-top:none;padding-top:0}

  nav li.has-submenu.submenu-open .nav-mega{display:block}
  nav li.has-submenu > a{justify-content:space-between;width:100%}
}

/* Floating contact/chat widget (site-wide) */
.chat-widget{position:fixed;right:20px;bottom:16px;z-index:1200;font-family:'Poppins',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}

.chat-fab{width:58px;height:58px;border-radius:999px;border:none;cursor:pointer;display:grid;place-items:center;
  background:radial-gradient(120px 80px at 30% 30%, #86d55e, var(--brand, #77c34f));
  box-shadow:0 16px 44px rgba(2,8,23,.26);
  transition:transform .16s ease, box-shadow .16s ease, filter .16s ease
}
.chat-fab:hover{transform:translateY(-1px);box-shadow:0 20px 55px rgba(2,8,23,.28);filter:saturate(1.03)}
.chat-fab:active{transform:translateY(0)}
.chat-fab:focus-visible{outline:3px solid rgba(119,195,79,.55);outline-offset:4px}
.chat-fab svg{width:28px;height:28px;color:#fff;display:block}

.chat-panel{position:absolute;right:0;bottom:74px;width:360px;max-width:min(92vw, 360px);
  background:#fff;border-radius:18px;overflow:hidden;
  border:1px solid rgba(148,163,184,.45);
  box-shadow:0 26px 70px rgba(2,8,23,.22);
  transform:translateY(10px);opacity:0;pointer-events:none;transition:.18s ease
}
.chat-widget.is-open .chat-panel{opacity:1;pointer-events:auto;transform:translateY(0)}

.chat-header{position:relative;padding:16px 16px 18px;color:#fff;
  background:linear-gradient(135deg, #1dbb60, var(--brand-dark, #1f6b35));
}
.chat-header::after{content:'';position:absolute;left:-8%;right:-8%;bottom:-18px;height:46px;
  background:radial-gradient(70px 50px at 12% 20%, rgba(255,255,255,.22), transparent 60%),
             radial-gradient(80px 55px at 42% 40%, rgba(255,255,255,.18), transparent 62%),
             radial-gradient(90px 58px at 76% 30%, rgba(255,255,255,.16), transparent 62%);
  opacity:.85;border-bottom-left-radius:20px;border-bottom-right-radius:20px
}
.chat-header-row{position:relative;display:flex;align-items:flex-start;gap:10px;z-index:1}
.chat-header-back{width:36px;height:36px;border:none;border-radius:10px;background:rgba(255,255,255,.14);color:#fff;cursor:pointer;display:grid;place-items:center;flex:0 0 auto}
.chat-header-back:hover{background:rgba(255,255,255,.18)}
.chat-header-close{margin-left:auto;width:36px;height:36px;border:none;border-radius:10px;background:rgba(255,255,255,.14);color:#fff;cursor:pointer;display:grid;place-items:center;flex:0 0 auto}
.chat-header-close:hover{background:rgba(255,255,255,.18)}
.chat-title{margin:0;font-size:20px;font-weight:800;line-height:1.1}
.chat-subtitle{margin-top:6px;font-size:12px;line-height:1.4;color:rgba(255,255,255,.88)}

.chat-body{padding:18px 14px 14px}
.chat-menu{display:flex;flex-direction:column;gap:10px}
.chat-option{width:100%;display:flex;align-items:center;gap:12px;padding:12px;border-radius:14px;
  border:1px solid rgba(148,163,184,.35);background:#fff;color:var(--ink, #0b2a1b);text-align:left;cursor:pointer;
  transition:.15s ease
}
.chat-option:hover{background:rgba(117,191,83,.10)}
.chat-option:focus-visible{outline:3px solid rgba(119,195,79,.55);outline-offset:3px}
.chat-ico{width:40px;height:40px;border-radius:999px;display:grid;place-items:center;color:#fff;flex:0 0 auto}
.chat-ico svg{width:18px;height:18px;display:block}
.chat-option strong{display:block;font-size:14px;font-weight:800}
.chat-option span{display:block;font-size:12px;color:rgba(2,8,23,.58);margin-top:2px}

.chat-convo{display:flex;flex-direction:column;height:360px}
.chat-messages{flex:1;overflow:auto;padding:8px 4px 12px}
.chat-bubble{max-width:88%;padding:10px 12px;border-radius:14px;font-size:13px;line-height:1.45}
.chat-bubble.them{background:#f3f6fb;border:1px solid rgba(148,163,184,.28);color:rgba(2,8,23,.82)}
.chat-messages .chat-bubble{margin:0 6px 10px}

.chat-compose{border-top:1px solid rgba(148,163,184,.25);padding:10px 8px 8px;display:flex;gap:10px;align-items:flex-end}
.chat-input{flex:1;min-height:44px;max-height:110px;resize:none;border-radius:14px;border:1px solid rgba(148,163,184,.35);
  padding:10px 12px;font:500 13px/1.4 'Poppins',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;outline:none
}
.chat-input:focus{border-color:rgba(119,195,79,.6);box-shadow:0 0 0 4px rgba(119,195,79,.16)}
.chat-send{width:44px;height:44px;border:none;border-radius:14px;cursor:pointer;display:grid;place-items:center;
  background:var(--brand, #77c34f);color:#fff;box-shadow:0 12px 26px rgba(31,107,53,.24)
}
.chat-send:hover{filter:saturate(1.04)}
.chat-send:focus-visible{outline:3px solid rgba(119,195,79,.55);outline-offset:3px}
.chat-send svg{width:18px;height:18px;display:block}

.chat-hidden{display:none !important}

/* Ensure the back-to-top button doesn't overlap the chat widget */
.back-to-top{bottom:92px !important}

@media(max-width:560px){
  .chat-widget{right:12px;bottom:12px}
  .chat-panel{bottom:70px;width:min(92vw, 380px)}
  .chat-convo{height:min(62vh, 420px)}
  .back-to-top{bottom:86px !important}
}

@media(max-width:420px){
  .chat-panel{left:0;right:0;margin:0 auto;width:calc(100vw - 24px)}
  .chat-compose{gap:8px}
  .chat-input{min-height:42px}
  .chat-send{width:42px;height:42px}
}

@media (prefers-reduced-motion: reduce){
  .chat-panel,.chat-fab{transition:none}
}

@media print{.chat-widget{display:none}}
